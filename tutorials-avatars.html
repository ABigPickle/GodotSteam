<!DOCTYPE HTML>
<html>
	<head>
		<title>GodotSteam - A Steamworks Module For Godot Engine | By Gramps | GitHub</title>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="css/main.css" />
		<link rel="stylesheet" href="css/font-awesome.min.css" />
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<!--[if lt IE 8]>
		<link rel="stylesheet" href="{{ '/css/ie.css' | relative_url }}">
		<![endif]-->
	</head>
	<body class="is-preload">
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo"><strong>GodotSteam</strong> A Steamworks module for Godot Engine</a>
					</header>
					<!-- Section -->
					<section>
						<header class="main">
							<h1>Tutorials - Avatars</h1>
						</header>
						<p>You may want to get the current player's avatar, or someone else's. This can be achieved by requesting it with the following line:</p>
<pre><code>
Steam.getPlayerAvatar(Steam.AVATAR_MEDIUM)
</code></pre><br/>
						<p>You may pass it either <strong>Steam.AVATAR_SMALL</strong>, <strong>Steam.AVATAR_MEDIUM</strong>, or <strong>Steam.AVATAR_LARGE</strong>. Additionally you can pass along a Steam ID64 to get a specific user or, if no ID is provided, it will get the current user.</p>
						<p>To retrieve the avatar data buffer, you'll need to hook the signal for the callback:</p>
<pre><code>
Steam.connect("avatar_loaded", self, "loaded_avatar")
</code></pre><br/>
						<p>This will return the user's Steam ID, the avatar's size, and the data buffer for rendering the image.  Our <strong>loaded_avatar</strong> function will look something like this:</p>
<pre><code>
func loaded_avatar(id, size, buffer):
	print("Avatar for user: "+str(id))
	print("Size: "+str(size))
	# Create a new image and texture to fill out
	var AVATAR = Image.new()
	var AVATAR_TEXTURE = ImageTexture.new()
	AVATAR.create(size, size, false, Image.FORMAT_RGBAF)

	# Lock the image and fill the pixels from the data buffer
	AVATAR.lock()
	for y in range(0, size):
		for x in range(0, size):
			var pixel = 4 * (x + y * size)
			var r = float(buffer[pixel]) / 255
			var g = float(buffer[pixel+1]) / 255
			var b = float(buffer[pixel+2]) / 255
			var a = float(buffer[pixel+3]) / 255
			AVATAR.set_pixel(x, y, Color(r, g, b, a))
	AVATAR.unlock()

	# Now apply the texture
	AVATAR_TEXTURE.create_from_image(AVATAR)

	# For our purposes, set a sprite with the avatar texture
	$Sprite.set_texture(AVATAR_TEXTURE)
</code></pre><br/>
					<p>Naturally that texture could be applied elsewhere, depending on where you place this function.</p>
					<p>A longer, but similar way to get the end result could look like this:</p>
<pre><code>
# Request one or all sizes
var HANDLE1 = Steam.getSmallFriendAvatar(steamID)
#var HANDLE2 = Steam.getMediumFriendAvatar(steamID)
#var HANDLE3 = Steam.getLargeFriendAvatar(steamID)

# Using the small avatar handle
var IMAGE = Steam.getImageSize(HANDLE1)
var IMAGE_DATA = Steam.getImageRGBA(HANDLE3)

# Now create the avatar like before
var AVATAR = Image.new()
var AVATAR_TEXTURE = ImageTexture.new()
AVATAR.create(IMAGE['width'], IMAGE['height'], false, Image.FORMAT_RGBAF)

# Lock the image and fill the pixels from the data buffer
AVATAR.lock()
for y in range(0, size):
	for x in range(0, size):
		var pixel = 4 * (x + y * size)
		var r = float(IMAGE_DATA['buffer'][pixel]) / 255
		var g = float(IMAGE_DATA['buffer'][pixel+1]) / 255
		var b = float(IMAGE_DATA['buffer'][pixel+2]) / 255
		var a = float(IMAGE_DATA['buffer'][pixel+3]) / 255
		AVATAR.set_pixel(x, y, Color(r, g, b, a))
AVATAR.unlock()

# Now apply the texture
AVATAR_TEXTURE.create_from_image(AVATAR)

# For our purposes, set a sprite with the avatar texture
$Sprite.set_texture(AVATAR_TEXTURE)
</code></pre><br/>
						<p>That covers the basics of getting player avatars.</p>
					</section>
					<footer id="footer">
						Godot Engine by <a href="https://godotengine.org">Juan Linietsky, Ariel Manzur and contributors</a><br />
						Steamworks API by <a href="https://valvesoftware.com">Valve Corporation</a><br />
						GodotSteam by <a href="https://coaguco.com">GP Garcia</a> and contributors<br />
						Site Template by <a href="https://html5up.net">HTML5UP</a>
					</footer>
				</div>
			</div>
			<!-- Sidebar -->
			<div id="sidebar">
				<div class="inner">
					<!-- Menu -->
					<nav id="menu">
						<header class="major">
							<h2>Menu</h2>
						</header>
						<ul>
							<li><a href="index.html">Introduction</a></li>
							<li>
								<span class="opener">How-To's</span>
								<ul>
									<li><a href="howto-module.html">How-To Godot 2 & 3</a></li>
									<li><a href="howto-gdnative.html">How-To GDNative</a></li>
									<li><a href="howto-server.html">How-To Server</a></li>
								</ul>
							</li>
							<li>
								<span class="opener">Functions</span>
								<ul>
									<li><a href="functions-module.html">Functions (Module) </a></li>
									<li><a href="functions-server.html">Functions (Server)</a></li>
								</ul>
							</li>
							<li>
								<span class="opener">Signals</span>
								<ul>
									<li><a href="signals-modules.html">Signals (Module)</a></li>
									<li><a href="signals-server.html">Signals (Server)</a></li>
								</ul>
							</li>
							<li>
								<span class="opener">Tutorials</span>
								<ul>
									<li><a href="tutorials-initializing.html">Initializing Steam</a></li>
									<li><a href="tutorials-stats-achievements.html">Stats and Achievements</a></li>
									<li><a href="tutorials-avatars.html">Avatars</a></li>
									<li><a href="tutorials-lobbies-p2p.html">Lobbies / P2P Networking</a></li>
									<li><a href="tutorials-mac-export.html">Mac Exporting</a></li>
									<li><a href="tutorials-achievement-icons.html">Achievement Icons</a></li>
									<li><a href="tutorials-rich-presence.html">Rich Presence</a></li>
									<li><a href="tutorials-linux-caveats.html">Linux Caveats</a></li>
								</ul>
							</li>
							<li><a href="games.html">Games Using GodotSteam</a></li>
							<li><a href="todo.html">To-Do</a></li>
							<li><a href="changelog.html">Change Log</a></li>
							<li><a href="contributors.html">Contributors / Donate</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
		<!-- Scripts -->
		<script src="js/jquery.min.js"></script>
		<script src="js/browser.min.js"></script>
		<script src="js/breakpoints.min.js"></script>
		<script src="js/util.js"></script>
		<script src="js/main.js"></script>
	</body>
</html>